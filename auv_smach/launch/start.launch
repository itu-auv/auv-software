<?xml version="1.0"?>
<launch>
    <arg name="namespace" default="taluy" />
    <arg name="torpedo_id" default="1" />
    <arg name="enable_rate" default="20" />
    <param name="/smach/max_linear_velocity" value="0.3" />
    <param name="/smach/max_angular_velocity" value="0.45" />

    <!-- Test Mode Configuration -->
    <arg name="test_mode" default="false" doc="Enable test mode for state machine"/>
    <arg name="test_states" default="[]" doc="States to execute in test mode"/>

    <group ns="$(arg namespace)">
        <!-- Main State Machine Node -->
        <node name="main_state_machine" pkg="auv_smach" type="main_state_machine.py" output="screen">
            <remap from="propulsion_board/status" to="propulsion_board/status"/>
            <param name="~base_link" value="$(arg namespace)/base_link"/>

            <!-- common.py -->
            <remap from="clear_object_transforms" to="map/clear_object_transforms"/>
            <remap from="torpedo_$(arg torpedo_id)/launch" to="actuators/torpedo_$(arg torpedo_id)/launch"/>
            <remap from="ball_dropper/drop" to="actuators/ball_dropper/drop"/>
            <remap from="align_frame/cancel" to="control/align_frame/cancel"/>
            <remap from="align_frame/start" to="control/align_frame/start"/>
            <remap from="enable" to="enable"/>
            <remap from="propulsion_board/status" to="propulsion_board/status"/>
            <remap from="odometry" to="odometry"/>
            <remap from="cmd_vel" to="cmd_vel"/>

            <!-- camera_detection_pose_estimator.py -->
            <remap from="enable_front_camera_detections" to="vision/enable_front_camera_detections"/>
            <remap from="enable_bottom_camera_detections" to="vision/enable_bottom_camera_detections"/>

            <param name="enable_rate" value="$(arg enable_rate)"/>

            <!-- gate.py -->
            <remap from="toggle_gate_trajectory" to="toggle_gate_trajectory"/>

            <!--initialize.py-->
            <remap from="set_depth" to="set_depth"/>
            <remap from="set_pose" to="set_pose"/>
            <remap from="dvl/enable" to="sensors/dvl/enable"/>
            <remap from="localization_enable" to="auv_localization_node/enable"/>

            <!--red_buoy.py-->
            <remap from="set_object_transform" to="map/set_object_transform"/>

            <!--bin.py-->
            <remap from="toggle_bin_trajectory" to="toggle_bin_trajectory"/>

            <param name="test_mode" value="$(arg test_mode)"/>
            <param name="test_states" value="$(arg test_states)"/>
            <!-- Load path planner parameters in the node -->
            <rosparam file="$(find auv_navigation)/config/path_planner_config.yaml" command="load"/>
            <!-- Load main state machine parameters -->
            <rosparam file="$(find auv_smach)/config/main_state_machine.yaml" command="load"/>
        </node>
    </group>
</launch>
