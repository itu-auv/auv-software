<launch>
  <arg name="namespace" default="taluy" />

  <!-- YOLO to Mask Node -->
  <node
    pkg="auv_detection"
    type="yolo_to_mask_node.py"
    name="yolo_to_mask_node"
    output="screen">
  </node>

  <!-- Bottle Error Detector Node -->
  <node
    pkg="auv_detection"
    type="bottle_error_detector.py"
    name="bottle_error_detector"
    output="screen">

    <!-- Input topic: mask image (mono8) -->
    <param name="mask_topic" value="/pipe_mask"/>

    <!-- Output topics -->
    <param name="errors_topic" value="/bottle_vsc_errors"/>
    <param name="viz_topic" value="/bottle_vsc_viz"/>

    <!-- Image orientation parameters -->
    <param name="rotate_cw" value="0"/>  <!-- 0/1/2/3 for 0/90/180/270 degrees CW rotation -->
    <param name="flip_x" value="false"/> <!-- horizontal flip -->
    <param name="flip_y" value="false"/> <!-- vertical flip -->

    <!-- Minimum area threshold (pixels) -->
    <param name="min_area_px" value="500"/>
  </node>

  <group ns="$(arg namespace)">
    <node
      pkg="auv_vision"
      type="dynamic_roll_compensation.py"
      name="dynamic_roll_compensation_node"
      output="screen">
      <remap from="odometry" to="odometry" />
      <remap from="camera/image_rect_color" to="cameras/cam_front/image_rect_color" />
      <remap from="camera/image_corrected" to="cameras/cam_front/image_corrected" />

      <param name="sync_queue_size" value="10"/>
      <param name="sync_slop" value="0.05"/>
      <param name="recalc_threshold_deg" value="0.1"/>
    </node>
    <node
      pkg="auv_detection"
      type="yolo_image_annotator.py"
      name="yolo_image_annotator_node"
      output="screen">

      <param name="save_directory" value="/home/agxorin/yolo_annotated_images"/>
      <param name="font_scale" value="0.7"/>
      <param name="font_thickness" value="2"/>
    </node>
  </group>
</launch>
