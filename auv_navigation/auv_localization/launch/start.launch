<?xml version="1.0"?>
<launch>
  <arg name="namespace" default="taluy" />
  <arg name="rate" default="20" />
  <arg name="imu_topic" default="$(eval '/vectornav/IMU' if arg('namespace') == 'taluy_mini' else 'sensors/imu/data')" />
  <arg name="dvl_velocity_topic" default="$(eval 'dvl/velocity' if arg('namespace') == 'taluy_mini' else 'sensors/dvl/velocity_raw')" />

  <group ns="$(arg namespace)">
    <rosparam file="$(find auv_localization)/config/$(arg namespace)/sensor_calibration_data.yaml" />

    <node pkg="auv_localization" type="imu_odometry_node.py" name="imu_to_odom_node" output="screen">
      <param name="namespace" value="$(arg namespace)" />
      <param name="imu_frame" value="$(arg namespace)/base_link/imu_link" />
      <param name="imu_calibration_path" value="$(find auv_localization)/config/$(arg namespace)/imu_calibration_data.yaml" />
      <remap from="imu/data" to="$(arg imu_topic)" />
      <remap from="odom_imu" to="localization/odom_imu" />
    </node>
    <node pkg="auv_localization" type="pressure_odometry_node.py" name="pressure_to_odom_node"
      output="screen">
      <param name="namespace" value="$(arg namespace)" />
      <rosparam file="$(find auv_localization)/config/$(arg namespace)/sensor_calibration_data.yaml" command="load" />
      <remap from="depth" to="sensors/external_pressure_sensor/depth" />
      <remap from="odom_pressure" to="localization/odom_pressure" />
      <remap from="imu/data" to="$(arg imu_topic)" />
      <remap from="dvl/altitude" to="sensors/dvl/altitude"/>
    </node>
    <node pkg="auv_localization" type="dvl_odometry_node.py" name="dvl_to_odom_node" output="screen">
      <param name="namespace" value="$(arg namespace)" />
      <remap from="sensors/dvl/velocity_raw" to="$(arg dvl_velocity_topic)" />
      <remap from="odom_dvl" to="localization/odom_dvl" />
      <remap from="dvl/velocity_raw" to="$(arg dvl_velocity_topic)" />
      <remap from="dvl/is_valid" to="sensors/dvl/is_valid" />
      <remap from="cmd_vel" to="cmd_vel" />
      <remap from="dvl_to_odom_node/enable" to="dvl_to_odom_node/enable" />
      <param name="cmdvel_tau" value="0.2" />
    </node>

    <!-- Euler Orientation Publisher Node -->
    <node pkg="auv_localization" type="euler_orientation_publisher.py" name="euler_orientation_publisher" output="screen">
      <remap from="odometry" to="odometry" />
      <remap from="euler_orientation" to="localization/euler_orientation" />
    </node>
  </group>
</launch>
