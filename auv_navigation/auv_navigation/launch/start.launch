<?xml version="1.0"?>
<launch>
  <!-- Change this to run multiple robots side-by-side -->
  <arg name="namespace"      default="taluy"/>

  <!-- ─────────────────────  static TF if you lack a map frame  ──────────── -->
  <!-- Delete if you truly never use /map                                 -->
  <node pkg="tf2_ros" type="static_transform_publisher" name="map_to_odom"
        args="0 0 0 0 0 0 map odom"/>

  <!-- ─────────────────────  Everything lives under /<ns>/…  ─────────────── -->
  <group ns="$(arg namespace)">

    <!-- FollowPath action server (your own package) -->
    <node pkg="auv_navigation"
          type="follow_path_action_server.py"
          name="follow_path_action_server"
          output="screen"/>

    <!-- ─────────────  Move Base Flex (logic only, no embedded costmaps) ─── -->
    <node pkg="move_base_flex"
          type="move_base_flex"
          name="move_base_flex"
          output="screen">

      <!-- Main MBF YAML: controllers, planners, recovery cfg, costmap_common -->
      <rosparam file="$(find auv_navigation)/config/move_base_flex.yaml"
                command="load"/>

      <!-- Local-planner-specific params (e.g. TEB / DWA) -->
      <rosparam ns="DWAPlannerROS"
                file="$(find auv_navigation)/config/mbf_local_planner_params.yaml"
                command="load"/>

      <!-- Global-planner params -->
      <rosparam ns="GlobalPlanner"
                file="$(find auv_navigation)/config/mbf_global_planner_params.yaml"
                command="load"/>

      <!-- Recovery behaviours -->
      <rosparam file="$(find auv_navigation)/config/mbf_recovery_params.yaml"
                command="load"/>
    </node>

    <!-- ─────────────────────  Global Costmap Server  ────────────────────── -->
    <node pkg="mbf_costmap_nav"
          type="costmap_server"
          name="global_costmap"
          ns="move_base_flex"
          output="screen">
      <!-- Load the same YAML: global_costmap + costmap_common blocks -->
      <rosparam command="load"
                file="$(find auv_navigation)/config/move_base_flex.yaml"/>
    </node>

    <!-- ─────────────────────  Local Costmap Server  ─────────────────────── -->
    <node pkg="mbf_costmap_nav"
          type="costmap_server"
          name="local_costmap"
          ns="move_base_flex"
          output="screen">
      <!-- Same YAML again (local_costmap + costmap_common) -->
      <rosparam command="load"
                file="$(find auv_navigation)/config/move_base_flex.yaml"/>
    </node>

  </group>
</launch>
